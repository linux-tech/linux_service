#!/bin/bash

TAG_LIST=/tmp/tag.list
echo "ä¸ºäº†ç®€åŒ–ç¨‹åºï¼Œéœ€è¦åœ¨æ‰€éœ€æ“ä½œçš„ä»“åº“ç›®å½•ä¸‹è¿›è¡Œæ“ä½œã€‚"
# æ‰“å° LOGO
cat <<'EOF'
[1:36m
					_ _  __              _                  
                    | (_)/ _|            | |                 
 _ __ ___   ___   __| |_| |_ _   _ ______| |_ __ _  __ _ ___ 
| '_ ` _ \ / _ \ / _` | |  _| | | |______| __/ _` |/ _` / __|
| | | | | | (_) | (_| | | | | |_| |      | || (_| | (_| \__ \
|_| |_| |_|\___/ \__,_|_|_|  \__, |       \__\__,_|\__, |___/
                              __/ |                 __/ |    
                             |___/                 |___/     
[0m							 
EOF

# åˆ é™¤åŸæœ‰ tag
echo "åˆ‡æ¢åˆ°ä¸»åˆ†æ”¯" && git checkout master || exit
echo "è·å–æœ€æ–°ä»£ç " && git pull || exit
echo "æ˜¾ç¤ºæ‰€æœ‰ tag ä¿¡æ¯" && git tag | tee ${TAG_LIST}  2>&1
read -p "è¯·è¾“å…¥éœ€è¦ä¿®æ”¹çš„ tag :" TAG
if `fgrep -qi "${TAG}" ${TAG_LIST}`;then
    git tag -d ${TAG} && echo "æœ¬åœ° tag: ${TAG} å·²ç»åˆ é™¤"
	git push origin :refs/tags/${TAG} && echo "è¿œç¨‹ tag: ${TAG} å·²ç»åˆ é™¤"
else
    read -p "è¯·ç¡®è®¤æ‚¨è¦åˆ é™¤çš„ tag ä¸º ${TAG}: [Y|N]" OPTION
	case ${OPTION} in 
	y|Y|yes|YES)
	    echo "æ‚¨è¾“å…¥çš„ tag ä¸å­˜åœ¨ï¼Œè¿™è¯´æ˜å½“å‰ä»£ç æˆ–è®¸ä¸æ˜¯æœ€æ–°çš„ï¼Œè¯·æ‰‹åŠ¨ pull æœ€æ–°ä»£ç ã€‚"
		git pull
		exit
		;;
	*)
	    echo "ç¨‹åºå³å°†é€€å‡ºï¼Œè¯·å†æ¬¡è¿è¡Œè¯¥ç¨‹åºä»¥è¾“å…¥æ­£ç¡®çš„ tag ä¿¡æ¯"
		sleep 2
		exit
		;;
	esac
fi

# é‡æ–°åˆ›å»º tag
git tag ${TAG}
git push origin ${TAG}
git show ${TAG}
